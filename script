#! /usr/bash

#if AWS CLI isn't installed, install

aws_cli_path="/usr/local/aws-cli/v2/current/bin/aws"

if [[ -e "$aws_cli_path" && -s "$aws_cli_path" ]]; then
    
    #verify or configure credentials

    config_file="$HOME/.aws/credentials"
    
    if [[ -e "$config_file" ]] && grep -q "\[default\]" "$config_file"; then
        :
    else
        echo "Please provide your AWS access key id:"
        read -r accesskey_id 
        echo "Please provide your secret access key:"
        read -r secret_access_key
        
        echo -e "[default]\naws_access_key_id = $accesskey_id\naws_secret_access_key = $secret_access_key" > "$config_file"  
    fi
else
    echo "Installing AWS CLI..."
    curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" && unzip awscliv2.zip && sudo ./aws/install
    
    exit_code=$?
    
    #If installation was successful, configure creditials
    if [ $exit_code -eq 0 ]; then
        echo "Please provide your AWS access key id:"
        read -r accesskey_id 
        echo "Please provide your secret access key:"
        read -r secret_access_key
        
        echo -e "[default]\naws_access_key_id = $accesskey_id\naws_secret_access_key = $secret_access_key" > "$config_file"
    else
        echo "Unable to auto-install AWS CLI. Please install manually and try again."   
    fi 
fi